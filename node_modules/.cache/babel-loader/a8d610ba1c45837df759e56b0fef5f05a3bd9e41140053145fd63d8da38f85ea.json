{"ast":null,"code":"import _regeneratorRuntime from\"/Users/uvixmi/social-network/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/uvixmi/social-network/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/Users/uvixmi/social-network/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/uvixmi/social-network/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{userAPI}from\"../api/api\";import{updateObjectInArray}from\"../utils/object-helpers\";var FOLLOW=\"FOLLOW\";var UNFOLLOW=\"UNFOLLOW\";var USERS=\"USERS\";var SET_CURRENT_PAGE=\"SET_CURRENT_PAGE\";var SET_TOTAL_COUNT=\"SET_TOTAL_COUNT\";var TOGGLE_IS_FETCHING=\"TOGGLE_IS_FETCHING\";var TOGGLE_IS_FOLLOWING_PROGRESS=\"TOGGLE_IS_FOLLOWING_PROGRESS\";var initialState={users:[],pageSize:10,totalUsersCount:22,currentPage:1,isFetching:true,followingInProgress:[]};var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,\"id\",{followed:true})});case UNFOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,\"id\",{followed:false})});case USERS:return _objectSpread(_objectSpread({},state),{},{users:_toConsumableArray(action.users)});case SET_CURRENT_PAGE:return _objectSpread(_objectSpread({},state),{},{currentPage:action.currentPage});case SET_TOTAL_COUNT:return _objectSpread(_objectSpread({},state),{},{totalUsersCount:action.totalCount});case TOGGLE_IS_FETCHING:return _objectSpread(_objectSpread({},state),{},{isFetching:action.isFetching});case TOGGLE_IS_FOLLOWING_PROGRESS:return _objectSpread(_objectSpread({},state),{},{followingInProgress:action.isFetching?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!=action.userId;})});default:return state;}};export var followSuccess=function followSuccess(userId){return{type:FOLLOW,userId:userId};};export var unfollowSuccess=function unfollowSuccess(userId){return{type:UNFOLLOW,userId:userId};};export var setUsers=function setUsers(users){return{type:USERS,users:users};};export var setCurrentPage=function setCurrentPage(currentPage){return{type:SET_CURRENT_PAGE,currentPage:currentPage};};export var setTotalUsersCount=function setTotalUsersCount(totalCount){return{type:SET_TOTAL_COUNT,totalCount:totalCount};};export var toggleIsFetching=function toggleIsFetching(isFetching){return{type:TOGGLE_IS_FETCHING,isFetching:isFetching};};export var toggleFollowingProgress=function toggleFollowingProgress(isFetching,userId){return{type:TOGGLE_IS_FOLLOWING_PROGRESS,isFetching:isFetching,userId:userId};};export var requestUsers=function requestUsers(currentPage,pageSize){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:dispatch(toggleIsFetching(true));_context.next=3;return userAPI.getUsers(currentPage,pageSize);case 3:data=_context.sent;dispatch(toggleIsFetching(false));dispatch(setUsers(data.items));dispatch(setCurrentPage(currentPage));dispatch(setTotalUsersCount(data.totalCount));case 8:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};var followUnfollowFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch,userId,apiMethod,actionCreator){var response;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:dispatch(toggleFollowingProgress(true,userId));_context2.next=3;return apiMethod(userId);case 3:response=_context2.sent;if(response.data.resultCode===0){dispatch(actionCreator(userId));}dispatch(toggleFollowingProgress(false,userId));case 6:case\"end\":return _context2.stop();}},_callee2);}));return function followUnfollowFlow(_x2,_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(dispatch){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:followUnfollowFlow(dispatch,userId,userAPI.follow.bind(userAPI),followSuccess);case 1:case\"end\":return _context3.stop();}},_callee3);}));return function(_x6){return _ref3.apply(this,arguments);};}();};export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(dispatch){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:followUnfollowFlow(dispatch,userId,userAPI.unfollow.bind(userAPI),unfollowSuccess);case 1:case\"end\":return _context4.stop();}},_callee4);}));return function(_x7){return _ref4.apply(this,arguments);};}();};export default usersReducer;","map":{"version":3,"names":["userAPI","updateObjectInArray","FOLLOW","UNFOLLOW","USERS","SET_CURRENT_PAGE","SET_TOTAL_COUNT","TOGGLE_IS_FETCHING","TOGGLE_IS_FOLLOWING_PROGRESS","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","followingInProgress","usersReducer","state","action","type","userId","followed","totalCount","filter","id","followSuccess","unfollowSuccess","setUsers","setCurrentPage","setTotalUsersCount","toggleIsFetching","toggleFollowingProgress","requestUsers","dispatch","getUsers","data","items","followUnfollowFlow","apiMethod","actionCreator","response","resultCode","follow","bind","unfollow"],"sources":["/Users/uvixmi/social-network/src/redux/users_reducer.js"],"sourcesContent":["import { userAPI } from \"../api/api\"\nimport { updateObjectInArray } from \"../utils/object-helpers\"\n\nconst FOLLOW = \"FOLLOW\"\nconst UNFOLLOW = \"UNFOLLOW\"\nconst USERS = \"USERS\"\nconst SET_CURRENT_PAGE = \"SET_CURRENT_PAGE\"\nconst SET_TOTAL_COUNT = \"SET_TOTAL_COUNT\"\nconst TOGGLE_IS_FETCHING = \"TOGGLE_IS_FETCHING\"\nconst TOGGLE_IS_FOLLOWING_PROGRESS = \"TOGGLE_IS_FOLLOWING_PROGRESS\"\n\nlet initialState = {\n  users: [],\n  pageSize: 10,\n  totalUsersCount: 22,\n  currentPage: 1,\n  isFetching: true,\n  followingInProgress: [],\n}\n\nconst usersReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case FOLLOW:\n      return {\n        ...state,\n        users: updateObjectInArray(state.users, action.userId, \"id\", {\n          followed: true,\n        }),\n      }\n\n    case UNFOLLOW:\n      return {\n        ...state,\n        users: updateObjectInArray(state.users, action.userId, \"id\", {\n          followed: false,\n        }),\n      }\n    case USERS:\n      return {\n        ...state,\n        users: [...action.users],\n      }\n    case SET_CURRENT_PAGE:\n      return {\n        ...state,\n        currentPage: action.currentPage,\n      }\n    case SET_TOTAL_COUNT:\n      return {\n        ...state,\n        totalUsersCount: action.totalCount,\n      }\n    case TOGGLE_IS_FETCHING:\n      return {\n        ...state,\n        isFetching: action.isFetching,\n      }\n\n    case TOGGLE_IS_FOLLOWING_PROGRESS:\n      return {\n        ...state,\n        followingInProgress: action.isFetching\n          ? [...state.followingInProgress, action.userId]\n          : state.followingInProgress.filter((id) => id != action.userId),\n      }\n    default:\n      return state\n  }\n}\nexport const followSuccess = (userId) => {\n  return {\n    type: FOLLOW,\n    userId,\n  }\n}\nexport const unfollowSuccess = (userId) => {\n  return {\n    type: UNFOLLOW,\n    userId,\n  }\n}\n\nexport const setUsers = (users) => {\n  return {\n    type: USERS,\n    users,\n  }\n}\nexport const setCurrentPage = (currentPage) => {\n  return {\n    type: SET_CURRENT_PAGE,\n    currentPage,\n  }\n}\nexport const setTotalUsersCount = (totalCount) => {\n  return {\n    type: SET_TOTAL_COUNT,\n    totalCount,\n  }\n}\nexport const toggleIsFetching = (isFetching) => {\n  return {\n    type: TOGGLE_IS_FETCHING,\n    isFetching,\n  }\n}\n\nexport const toggleFollowingProgress = (isFetching, userId) => {\n  return { type: TOGGLE_IS_FOLLOWING_PROGRESS, isFetching, userId }\n}\n\nexport const requestUsers = (currentPage, pageSize) => async (dispatch) => {\n  dispatch(toggleIsFetching(true))\n  let data = await userAPI.getUsers(currentPage, pageSize)\n\n  dispatch(toggleIsFetching(false))\n  dispatch(setUsers(data.items))\n  dispatch(setCurrentPage(currentPage))\n  dispatch(setTotalUsersCount(data.totalCount))\n}\n\nconst followUnfollowFlow = async (\n  dispatch,\n  userId,\n  apiMethod,\n  actionCreator\n) => {\n  dispatch(toggleFollowingProgress(true, userId))\n  let response = await apiMethod(userId)\n  if (response.data.resultCode === 0) {\n    dispatch(actionCreator(userId))\n  }\n  dispatch(toggleFollowingProgress(false, userId))\n}\n\nexport const follow = (userId) => {\n  return async (dispatch) => {\n    followUnfollowFlow(\n      dispatch,\n      userId,\n      userAPI.follow.bind(userAPI),\n      followSuccess\n    )\n  }\n}\n\nexport const unfollow = (userId) => {\n  return async (dispatch) => {\n    followUnfollowFlow(\n      dispatch,\n      userId,\n      userAPI.unfollow.bind(userAPI),\n      unfollowSuccess\n    )\n  }\n}\nexport default usersReducer\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}